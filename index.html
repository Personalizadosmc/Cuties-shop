<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Mariposas Cuties - Tienda Oficial</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  
  <link rel="icon" type="image/png" href="Logo.PNG">
  <link rel="apple-touch-icon" href="Logo.PNG">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

<div id="loader-overlay" class="d-flex justify-content-center align-items-center position-fixed w-100 h-100 top-0 start-0 bg-white" style="z-index: 9999; transition: opacity 0.5s;">
    <div class="text-center">
        <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status"></div>
        <p class="mt-2 fw-bold text-primary animate-pulse">Cargando Mariposas Cuties...</p>
    </div>
</div>

<nav class="navbar navbar-expand-lg sticky-top glass-effect">
  <div class="container-fluid px-3 px-md-4">
    <button class="navbar-toggler border-0 text-white" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <i class="bi bi-list fs-1"></i>
    </button>

    <a class="navbar-brand me-auto" href="#" onclick="irASeccion('portada')">
      <i class="bi bi-stars me-1"></i> Mariposas Cuties
    </a>

    <button class="btn btn-link nav-link position-relative order-lg-last ms-2" onclick="irASeccion('carrito')" id="btnCarrito">
        <div class="icon-circle-bg">
            <i class="bi bi-cart-fill fs-5 text-white"></i>
        </div>
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark border border-light shadow-sm" id="cartCount">0</span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0 text-center text-lg-start" id="categoriaMenu">
        </ul>
      
      <hr class="d-lg-none text-white-50">

      <div class="d-flex flex-column flex-lg-row align-items-center gap-2">
          <div id="authButtonsContainer" class="d-flex gap-2">
            <button class="btn btn-outline-light btn-sm rounded-pill px-3" onclick="irASeccion('login')">Login</button>
            <button class="btn btn-light btn-sm text-primary fw-bold rounded-pill px-3" onclick="irASeccion('registro')">Registro</button>
          </div>

          <button class="btn btn-warning btn-sm d-none shadow-sm rounded-pill px-3" onclick="irASeccion('adminPanel')" id="btnAdminNav">
            <i class="bi bi-gear-fill"></i> Admin
          </button>

          <div id="userDropdownContainer" class="d-none">
            <div class="dropdown">
                <button class="btn btn-light btn-sm dropdown-toggle text-primary fw-bold rounded-pill px-3" type="button" data-bs-toggle="dropdown">
                    <i class="bi bi-person-check-fill"></i> <span id="userNameNav">Usuario</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end border-0 shadow-lg p-2 rounded-4">
                    <li><a class="dropdown-item rounded-3" href="#" onclick="cerrarSesion()"><i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión</a></li>
                </ul>
            </div>
          </div>
      </div>
    </div>
  </div>
</nav>

<div class="container my-4 my-md-5" style="min-height: 80vh;">
  
  <div id="portada" class="seccion active">
    <div class="text-center mb-5 animate-fade-in">
        <h1 class="display-5 fw-bold mb-2 text-gradient-primary">¿Qué Detalle Buscas Hoy?</h1>
        <p class="lead text-dark fw-bold mb-2">Artículos 100% Personalizados a tu gusto</p>
        <p class="text-muted small">El precio incluye el diseño y personalizado.</p>
        
        <div class="search-container mx-auto mt-4" style="max-width: 600px;">
            <div class="input-group shadow-sm rounded-pill overflow-hidden bg-white border">
                <span class="input-group-text bg-white border-0 ps-3"><i class="bi bi-search text-primary"></i></span>
                <input type="text" id="searchInput" class="form-control border-0 py-3" 
                       placeholder="Buscar (ej: Taza, Llavero...)" oninput="buscarProductos()">
            </div>
        </div>
    </div>

    <h3 class="mb-3 fw-bold ps-2 border-start border-4 border-primary">Explorar Categorías</h3>
    <div id="contenedorCategorias">
        <div class="row g-3 g-md-4" id="listaCategorias">
            </div>
    </div>

    <div id="contenedorResultados" class="d-none">
        <div class="d-flex justify-content-between align-items-center mb-3">
             <h4 class="text-muted">Resultados:</h4>
             <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="limpiarBusqueda()">
                <i class="bi bi-x-lg"></i> Cerrar búsqueda
             </button>
        </div>
        <div class="row g-3" id="listaResultados"></div>
    </div>
  </div>

  <div id="login" class="seccion">
    <div class="row justify-content-center">
      <div class="col-md-5 col-lg-4">
        <div class="card p-4 p-md-5 shadow-lg border-0 rounded-4">
          <div class="text-center mb-4">
              <div class="bg-primary-subtle rounded-circle d-inline-block p-3 mb-2">
                <i class="bi bi-person-circle fs-1 text-primary"></i>
              </div>
              <h3>Bienvenido</h3>
          </div>
          <form onsubmit="event.preventDefault(); iniciarSesion();">
            <div class="form-floating mb-3">
              <input type="text" id="loginUser" class="form-control rounded-3" placeholder="Usuario" required>
              <label>Usuario</label>
            </div>
            <div class="form-floating mb-4">
              <input type="password" id="loginPass" class="form-control rounded-3" placeholder="Contraseña" required>
              <label>Contraseña</label>
            </div>
            <button type="submit" class="btn btn-primary w-100 py-2 mb-3 rounded-pill shadow">Ingresar</button>
          </form>
          <div class="text-center mt-3">
              <a href="#" onclick="irASeccion('registro')" class="fw-bold text-primary text-decoration-none">Crear cuenta nueva</a>
              <div class="mt-3">
                <a href="#" onclick="irASeccion('portada')" class="text-secondary small text-decoration-none">← Volver al inicio</a>
              </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="registro" class="seccion">
    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">
        <div class="card p-4 shadow-sm border-0 rounded-4">
          <h3 class="mb-4 text-center text-primary fw-bold">Nueva Cuenta</h3>
          <form onsubmit="event.preventDefault(); registrarUsuario();">
            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="small text-muted fw-bold">Nombre</label>
                <input type="text" id="regNombre" class="form-control bg-light" required>
              </div>
              <div class="col-6">
                <label class="small text-muted fw-bold">Apellido</label>
                <input type="text" id="regApellido" class="form-control bg-light" required>
              </div>
            </div>
            <div class="mb-3">
              <label class="small text-muted fw-bold">Dirección</label>
              <input type="text" id="regDireccion" class="form-control bg-light" required>
            </div>
            <div class="mb-3">
              <label class="small text-muted fw-bold">Teléfono / WhatsApp</label>
              <input type="tel" id="regTelefono" class="form-control bg-light" required>
            </div>
            <hr>
            <div class="mb-3">
              <label class="small text-muted fw-bold">Usuario (Login)</label>
              <input type="text" id="regUser" class="form-control bg-light" required>
            </div>
            <div class="row g-2 mb-4">
                <div class="col-6">
                    <label class="small text-muted fw-bold">Contraseña</label>
                    <input type="password" id="regPass" class="form-control bg-light" required>
                </div>
                <div class="col-6">
                    <label class="small text-muted fw-bold">Confirmar</label>
                    <input type="password" id="regPassConfirm" class="form-control bg-light" required>
                </div>
            </div>
            <button type="submit" class="btn btn-success w-100 py-2 rounded-pill shadow">Registrarse</button>
          </form>
          <div class="text-center mt-3">
             <button class="btn btn-link text-secondary text-decoration-none" onclick="irASeccion('portada')">Cancelar</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="productos" class="seccion">
    <div class="d-flex justify-content-between align-items-center mb-4 sticky-sub-header bg-body pt-2 pb-2" style="top: 70px; z-index: 10;">
        <h3 id="tituloCategoria" class="text-primary fw-bold m-0">Productos</h3>
        <button class="btn btn-outline-secondary btn-sm rounded-pill" onclick="irASeccion('portada')">
            <i class="bi bi-arrow-left me-1"></i> Atrás
        </button>
    </div>
    <div class="row g-3" id="listaProductos">
        </div>
  </div>

  <div id="carrito" class="seccion">
    <div class="card p-3 p-md-4 border-0 shadow-sm rounded-4">
      <h3 class="mb-4 text-primary fw-bold"><i class="bi bi-cart4 me-2"></i>Tu Carrito</h3>
      
      <div class="table-responsive mb-4 rounded-3 border">
        <table class="table align-middle table-hover mb-0">
          <thead class="bg-light">
            <tr>
              <th class="py-3 ps-3">Detalle</th>
              <th class="text-center py-3">Precio</th>
              <th class="text-center py-3">Cant.</th>
              <th class="text-center py-3">Total</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="listaCarrito"></tbody>
          <tfoot class="border-top">
            <tr>
              <td colspan="3" class="text-end fw-bold py-3">Total:</td>
              <td class="text-center fw-bold fs-5 text-primary py-3" id="totalCarrito">RD$0.00</td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <div class="d-flex flex-column flex-md-row justify-content-between gap-3">
        <button class="btn btn-outline-danger rounded-pill" onclick="vaciarCarrito()">
            <i class="bi bi-trash"></i> Vaciar
        </button>
        <div class="d-flex flex-column flex-md-row gap-2">
            <button class="btn btn-secondary rounded-pill" onclick="irASeccion('portada')">Seguir comprando</button>
            <button class="btn btn-dark rounded-pill shadow" onclick="solicitarConfirmacion('imprimir_descargar')">
                <i class="bi bi-file-earmark-pdf-fill me-2"></i> Descargar Cotización
            </button>
            <button class="btn btn-success rounded-pill shadow animate-pulse" onclick="solicitarConfirmacion('whatsapp')">
                <i class="bi bi-whatsapp me-2"></i> Pedir por WhatsApp
            </button>
        </div>
      </div>
      <p class="mt-3 text-center text-muted small fst-italic">
        * Al finalizar, recibirás un número de turno para tu pedido.
      </p>
    </div>
  </div>

  <div id="adminPanel" class="seccion">
    <div class="card p-3 p-md-4 border-0 shadow-sm rounded-4">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0 text-primary fw-bold">Panel Admin</h4>
        <button class="btn btn-sm btn-outline-danger rounded-pill" onclick="cerrarSesion()">Salir</button>
      </div>
      
      <ul class="nav nav-pills nav-fill mb-4 gap-2 p-1 bg-light rounded-pill" role="tablist">
        <li class="nav-item">
          <button class="nav-link active rounded-pill" data-bs-toggle="tab" data-bs-target="#adminCategorias" onclick="cargarCategoriasAdmin()">Categorías</button>
        </li>
        <li class="nav-item">
          <button class="nav-link rounded-pill" data-bs-toggle="tab" data-bs-target="#adminProductos" onclick="cargarProductosAdmin()">Productos</button>
        </li>
        <li class="nav-item">
          <button class="nav-link rounded-pill position-relative" data-bs-toggle="tab" data-bs-target="#adminPedidos" onclick="cargarPedidosAdmin()"> 
            Pedidos <span class="position-absolute top-0 start-100 translate-middle badge rounded-circle bg-danger" id="badgeColaAdmin">0</span>
          </button>
        </li>
      </ul>

      <div class="tab-content">
        <div class="tab-pane fade show active" id="adminCategorias">
          <button class="btn btn-primary w-100 mb-3 rounded-pill" onclick="abrirModalCategoria()">
            <i class="bi bi-plus-circle"></i> Nueva Categoría
          </button>
          <div class="table-responsive rounded-3 border">
            <table class="table table-hover mb-0">
                <thead class="table-light"><tr><th>Img</th><th>Nombre</th><th>Acciones</th></tr></thead>
                <tbody id="tablaCategoriasAdmin"></tbody>
            </table>
          </div>
        </div>
        
        <div class="tab-pane fade" id="adminProductos">
          <button class="btn btn-primary w-100 mb-3 rounded-pill" onclick="abrirModalProducto()">
            <i class="bi bi-plus-circle"></i> Nuevo Producto
          </button>
          <div class="table-responsive rounded-3 border">
            <table class="table table-hover mb-0">
                <thead class="table-light"><tr><th>Img</th><th>Producto</th><th>Precio</th><th>Estado</th><th>Acciones</th></tr></thead>
                <tbody id="tablaProductosAdmin"></tbody>
            </table>
          </div>
        </div>

        <div class="tab-pane fade" id="adminPedidos">
           <div class="d-flex justify-content-between align-items-center mb-3">
               <h5 class="mb-0">Cola de Pedidos</h5>
               <button class="btn btn-sm btn-outline-primary rounded-pill" onclick="cargarPedidosAdmin()"><i class="bi bi-arrow-clockwise"></i> Refrescar</button>
           </div>
           <div class="row g-3" id="listaPedidosAdmin"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="contacto" class="seccion">
    <div class="row justify-content-center text-center">
        <div class="col-md-6">
            <div class="card p-5 border-0 shadow-sm rounded-4">
                <i class="bi bi-chat-heart fs-1 text-primary mb-3"></i>
                <h2 class="fw-bold">Contáctanos</h2>
                <p class="text-muted">Estamos para servirte y personalizar tus ideas.</p>
                <div class="d-grid gap-3 mt-4">
                    <a href="https://wa.me/18090000000" target="_blank" class="btn btn-success btn-lg rounded-pill">
                        <i class="bi bi-whatsapp me-2"></i> Escríbenos al WhatsApp
                    </a>
                    <a href="tel:8090000000" class="btn btn-outline-primary btn-lg rounded-pill">
                        <i class="bi bi-telephone me-2"></i> Llamar ahora
                    </a>
                </div>
                <button class="btn btn-link mt-4 text-muted" onclick="irASeccion('portada')">Volver al inicio</button>
            </div>
        </div>
    </div>
  </div>

</div>

<footer class="bg-white py-4 mt-auto border-top">
    <div class="container text-center">
        <div class="mb-3">
            <i class="bi bi-stars text-primary"></i> 
            <span class="fw-bold text-dark">Mariposas Cuties</span>
        </div>
        <p class="text-muted small mb-2">Personalizamos tus ideas con amor.</p>
        
        <div class="d-inline-block bg-light px-3 py-1 rounded-pill border shadow-sm mt-2">
            <small class="text-muted fw-bold">
                <i class="bi bi-eye-fill me-1 text-primary"></i> Visitas: 
                <span id="contador-visitas" class="text-dark">Cargando...</span>
            </small>
        </div>
        
        <div class="mt-3 small text-muted">
            &copy; 2024 Todos los derechos reservados.
        </div>
    </div>
</footer>

<a href="https://wa.me/18090000000" class="btn-whatsapp-float shadow-lg" target="_blank" title="Contáctanos por WhatsApp">
    <i class="bi bi-whatsapp"></i>
</a>

<div class="modal fade" id="modalProductoDetalle" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg"> <div class="modal-content border-0 rounded-4 overflow-hidden">
      <div class="row g-0">
          <div class="col-md-6 bg-light d-flex align-items-center justify-content-center p-3">
             <img src="" id="detalleImg" class="img-fluid rounded-3 shadow-sm" style="max-height: 350px;">
          </div>
          <div class="col-md-6">
              <div class="modal-header border-0 pb-0">
                  <span class="badge bg-primary-subtle text-primary rounded-pill px-3" id="detalleCat">Categoría</span>
                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body p-4">
                  <h3 class="fw-bold mb-2" id="detalleNombre">Nombre Producto</h3>
                  <h2 class="text-primary fw-bold mb-3" id="detallePrecio">RD$ 0.00</h2>
                  <div id="detalleEstado" class="mb-3"></div>
                  <p class="text-muted" id="detalleDesc">Descripción...</p>
              </div>
              <div class="modal-footer border-0 p-4 pt-0">
                  <button type="button" class="btn btn-primary w-100 py-2 rounded-pill shadow-sm" id="btnAgregarDetalle">
                      Agregar al Carrito
                  </button>
              </div>
          </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalDatosInvitado" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0">
      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold">Datos para el Pedido</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p class="text-muted small mb-3">Necesitamos estos datos para identificar tu orden en la fila.</p>
        <form id="formInvitado">
            <div class="form-floating mb-2">
                <input type="text" class="form-control rounded-3" id="invNombre" placeholder="Nombre" required>
                <label>Nombre</label>
            </div>
            <div class="form-floating mb-2">
                <input type="text" class="form-control rounded-3" id="invApellido" placeholder="Apellido" required>
                <label>Apellido</label>
            </div>
            <div class="form-floating mb-2">
                <input type="tel" class="form-control rounded-3" id="invTelefono" placeholder="Teléfono" required>
                <label>Teléfono / Celular</label>
            </div>
        </form>
      </div>
      <div class="modal-footer border-0">
        <button type="button" class="btn btn-primary w-100 rounded-pill" onclick="confirmarDatosInvitado()">Confirmar Pedido</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalConfirmacion" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0">
      <div class="modal-body text-center p-4">
        <i class="bi bi-question-circle-fill text-warning display-1 mb-3"></i>
        <h4 class="fw-bold">¿Estás seguro?</h4>
        <p class="text-muted" id="textoConfirmacion">...</p>
        <div class="d-flex justify-content-center gap-2 mt-4">
            <button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary rounded-pill px-4" id="btnConfirmarAccion">Sí, confirmar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalExitoOrden" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4 border-0">
      <div class="modal-body text-center p-5">
        <div class="mb-3 text-success animate-pulse">
            <i class="bi bi-check-circle-fill display-1"></i>
        </div>
        <h2 class="fw-bold text-success">¡Pedido Recibido!</h2>
        <p class="lead text-dark">Tu número de turno es:</p>
        <div class="display-3 fw-bold text-primary my-3 p-3 bg-light rounded-3 border border-primary border-dashed" id="numeroTurnoExito">#0</div>
        <p class="text-muted small">Guarda este número. Te contactaremos pronto.</p>
        <button type="button" class="btn btn-outline-dark rounded-pill mt-3 px-5" data-bs-dismiss="modal" onclick="vaciarCarrito()">Entendido</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalCategoria" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header"><h5 class="modal-title">Gestión Categoría</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <input type="hidden" id="catId">
          <div class="mb-3"><label>Nombre</label><input type="text" class="form-control" id="catNombre"></div>
          <div class="mb-3"><label>URL Imagen</label><input type="text" class="form-control" id="catImg"></div>
          <button class="btn btn-primary w-100 rounded-pill" onclick="guardarCategoria()">Guardar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalProducto" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-4">
      <div class="modal-header"><h5 class="modal-title">Gestión Producto</h5><button class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
          <input type="hidden" id="prodId">
          <div class="mb-2"><label>Categoría</label><select class="form-select" id="prodCatId"></select></div>
          <div class="mb-2"><label>Nombre</label><input type="text" class="form-control" id="prodNombre"></div>
          <div class="mb-2"><label>Precio</label><input type="number" class="form-control" id="prodPrecio"></div>
          <div class="mb-2"><label>URL Imagen</label><input type="text" class="form-control" id="prodImg"></div>
          <div class="mb-2"><label>Descripción</label><textarea class="form-control" id="prodDesc" rows="2"></textarea></div>
          <div class="form-check mb-3">
              <input class="form-check-input" type="checkbox" id="prodDisponible" checked>
              <label class="form-check-label">Disponible</label>
          </div>
          <button class="btn btn-primary w-100 rounded-pill" onclick="guardarProducto()">Guardar</button>
      </div>
    </div>
  </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="liveToast" class="toast align-items-center text-bg-dark border-0 rounded-pill" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body px-4" id="toastBody">
        Notificación
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
</body>
</html>
